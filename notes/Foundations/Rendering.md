# Next.js 的渲染策略

Next.js 提供了多种渲染页面的方式，让开发者能根据具体需求选择最佳策略。理解这些渲染模式的区别是掌握 Next.js 的关键。

## 客户端渲染 (CSR)

这是传统的 React 应用渲染方式：

1. 服务器发送一个几乎为空的 HTML 文件
2. 浏览器加载 JavaScript
3. JavaScript 执行，构建 UI 并请求数据
4. 用户看到完整的交互界面

**特点**：

- 初始加载较慢（需要等待 JS 下载、执行、数据获取）
- 首次内容显示延迟明显
- 搜索引擎难以索引内容（爬虫看到的是空白页面）
- 用户使用过程中切换页面快速

```
浏览器 -----请求页面----> 服务器
        <----空HTML------

        ---加载JS文件--->
        <----JS代码------

[执行JS]
[渲染界面]
[获取数据] ---API请求---> 服务器/API
           <---JSON数据---
[更新界面]
```

## 服务器端渲染 (SSR)

Next.js 的服务器端渲染流程：

1. 每次请求，服务器执行 React 组件代码
2. 服务器获取组件所需数据
3. 服务器生成完整的 HTML
4. 发送完整 HTML 到浏览器
5. 浏览器显示内容（此时可见但不可交互）
6. 加载 JavaScript（水合过程）
7. 界面变为可交互状态

**特点**：

- 首屏加载快（用户立即看到内容）
- 搜索引擎能完整索引内容
- 服务器需要处理每个请求（资源消耗较大）
- 页面切换需要完整的服务器请求-响应周期

```
浏览器 -----请求页面----> 服务器
                        [执行React组件]
                        [获取数据]
                        [生成HTML]
        <--完整HTML内容--

[显示内容]
        ---获取JS资源--->
        <-----JS代码-----

[水合(Hydration)]
[界面可交互]
```

## 静态站点生成 (SSG)

Next.js 的静态生成过程：

1. **构建时**（而非请求时）执行组件代码
2. 构建时获取所需数据
3. 生成静态 HTML 文件
4. 部署时，这些静态文件可以部署到 CDN
5. 用户请求页面时，直接从 CDN 获取预生成的 HTML
6. 后续的水合过程与 SSR 类似

**特点**：

- 最快的页面加载速度（CDN 分发）
- 服务器负载极小（不需要处理渲染）
- 搜索引擎优化效果最佳
- 内容更新需要重新构建和部署

## 增量静态再生成 (ISR)

ISR 是 Next.js 的创新功能，结合了 SSG 的性能和动态内容的灵活性：

1. 初始构建时生成静态页面
2. 设定内容"过期"时间
3. 请求过期内容时返回缓存版本，同时在后台重新生成新版本
4. 下一个请求将获得更新后的内容

**特点**：

- 保持静态页面的性能优势
- 内容可以定期更新
- 不需要完全重建应用
- 适合内容不频繁更新的场景

## 选择渲染策略

如何选择最合适的渲染策略？

- **纯静态内容**（如营销网站、文档）：选择 SSG
- **频繁更新的个性化内容**（如社交媒体 Feed）：选择 SSR
- **定期更新的内容**（如博客、产品目录）：选择 ISR
- **高度交互的应用**（如仪表板）：可使用 CSR 或与 SSR 结合

## 实际应用中的混合渲染

现代 Next.js 应用通常采用混合渲染策略：

- 静态页面（如首页、关于我们）使用 SSG
- 动态内容（如用户个人资料）使用 SSR
- 产品列表用 ISR 每小时更新一次
- 高度交互的部分（如购物车）使用客户端组件

## 相关概念

- [[CoreConcepts]] - Next.js 的核心概念
- [[ServerComponents]] - React Server Components
- [[ClientComponents]] - React Client Components
